# React Router 使用实战指南 🎯

> 路由配置好了，具体怎么用？这份指南手把手教你！

---

## 目录

1. [在浏览器中使用路由](#在浏览器中使用路由)
2. [在代码中使用路由](#在代码中使用路由)
3. [实际场景示例](#实际场景示例)
4. [常见操作演示](#常见操作演示)

---

## 在浏览器中使用路由

### 方式1️⃣: 直接输入 URL 访问

打开浏览器，在地址栏输入：

```
✅ http://localhost:3000/              → 首页（笔记列表）
✅ http://localhost:3000/about         → 关于页面
✅ http://localhost:3000/login         → 登录页面
✅ http://localhost:3000/profile       → 个人中心（需要登录）
✅ http://localhost:3000/notes/1       → 查看ID为1的笔记
✅ http://localhost:3000/edit/1        → 编辑ID为1的笔记
❌ http://localhost:3000/xyz           → 404页面（不存在的路径）
```

**试一试**：
1. 打开浏览器
2. 在地址栏输入 `http://localhost:3000/about`
3. 按回车
4. 看到关于页面了吗？这就是路由在工作！

---

### 方式2️⃣: 点击页面上的链接

应用中有导航栏（在 Layout.jsx 中定义），你可以点击：

```
┌────────────────────────────────────┐
│  📝 React 笔记本  |  🏠首页  |  📖关于  |  👤个人中心  |  🔐登录  │
└────────────────────────────────────┘
       ↑              ↑        ↑         ↑            ↑
    点击Logo      点击这些链接，就会跳转到对应页面
    回到首页      （不会刷新页面！）
```

**试一试**：
1. 在首页，点击"关于"链接
2. 观察页面变化：
   - ✅ URL 变成了 `/about`
   - ✅ 页面显示了关于内容
   - ✅ 但页面没有刷新（导航栏还在）
3. 点击浏览器的"后退"按钮
4. 是不是回到首页了？路由正常工作！

---

### 方式3️⃣: 点击笔记标题或编辑按钮

在首页的笔记列表中：

```
┌─────────────────────────────────┐
│  我的笔记标题  ← 点击这里查看详情 │
│  内容预览...                    │
│  [⭐] [✏️编辑] [🗑️删除]        │
│         ↑                       │
│    点击这里编辑                 │
└─────────────────────────────────┘
```

**试一试**：
1. 在首页创建一个笔记（如果还没有）
2. 点击笔记的**标题**
   - 跳转到 `/notes/123`（123是笔记ID）
   - 显示笔记详情页
3. 在详情页，点击**编辑按钮**
   - 跳转到 `/edit/123`
   - 显示编辑表单

---

## 在代码中使用路由

### 场景1️⃣: 创建可点击的链接

**文件位置**：任何组件中

**使用 Link 组件**：

```jsx
import { Link } from 'react-router-dom';

function MyComponent() {
  return (
    <div>
      {/* 👇 基础用法：跳转到固定路径 */}
      <Link to="/about">关于我们</Link>
      
      {/* 👇 动态路径：跳转到特定笔记 */}
      <Link to={`/notes/${noteId}`}>查看笔记</Link>
      
      {/* 👇 带样式的链接 */}
      <Link 
        to="/profile" 
        style={{ color: 'blue', textDecoration: 'none' }}
      >
        个人中心
      </Link>
    </div>
  );
}
```

**实际例子**：在 `NoteItem.jsx` 中

```jsx
// 让笔记标题可以点击跳转
<h3 
  onClick={() => onViewNote(note.id)}  // 调用父组件传来的函数
  style={{ cursor: 'pointer' }}
>
  {note.title}
</h3>

// 在 HomePage.jsx 中定义 onViewNote
const handleViewNote = (noteId) => {
  navigate(`/notes/${noteId}`);  // 跳转到详情页
};
```

---

### 场景2️⃣: 在函数中跳转（编程式导航）

**使用 useNavigate Hook**：

```jsx
import { useNavigate } from 'react-router-dom';

function MyComponent() {
  const navigate = useNavigate();
  
  // 示例1：按钮点击后跳转
  const handleClick = () => {
    navigate('/about');
  };
  
  // 示例2：表单提交后跳转
  const handleSubmit = () => {
    // 先保存数据
    saveData();
    // 再跳转
    navigate('/success');
  };
  
  // 示例3：条件判断后跳转
  const handleLogin = () => {
    if (loginSuccess) {
      navigate('/profile');
    } else {
      navigate('/login');
    }
  };
  
  // 示例4：返回上一页
  const handleBack = () => {
    navigate(-1);  // -1 表示后退一页
  };
  
  return (
    <div>
      <button onClick={handleClick}>跳转</button>
      <button onClick={handleBack}>返回</button>
    </div>
  );
}
```

**实际例子**：在 `NoteDetailPage.jsx` 中

```jsx
function NoteDetailPage() {
  const { id } = useParams();
  const navigate = useNavigate();
  
  // 删除笔记后返回首页
  const handleDelete = () => {
    if (window.confirm('确定删除？')) {
      // 删除笔记...
      deleteNote(id);
      
      // 跳转到首页
      navigate('/', { replace: true });
    }
  };
  
  return (
    <div>
      <button onClick={handleDelete}>删除</button>
      <button onClick={() => navigate(`/edit/${id}`)}>编辑</button>
      <button onClick={() => navigate(-1)}>返回</button>
    </div>
  );
}
```

---

### 场景3️⃣: 获取 URL 中的参数

**使用 useParams Hook**：

```jsx
import { useParams } from 'react-router-dom';

function NoteDetailPage() {
  // 假设 URL 是 /notes/123
  const { id } = useParams();  // id = "123"
  
  // ⚠️ 注意：id 是字符串，需要转换
  const noteId = parseInt(id);  // 转换为数字
  
  // 根据 ID 加载笔记
  useEffect(() => {
    const notes = JSON.parse(localStorage.getItem('notes') || '[]');
    const note = notes.find(n => n.id === noteId);
    setNote(note);
  }, [noteId]);
  
  return <div>笔记ID: {id}</div>;
}
```

**实际例子**：在你的项目中

```jsx
// 1️⃣ 在 AppRouter.jsx 中定义动态路由
<Route path="/notes/:id" element={<NoteDetailPage />} />

// 2️⃣ 用户访问 /notes/123

// 3️⃣ NoteDetailPage.jsx 中获取参数
function NoteDetailPage() {
  const { id } = useParams();  // id = "123"
  
  // 使用这个 ID 做任何事情
  console.log('当前查看的笔记ID:', id);
}
```

---

### 场景4️⃣: 保护需要登录的页面

**使用 ProtectedRoute 组件**：

```jsx
// 在 AppRouter.jsx 中
<Route 
  path="/profile" 
  element={
    <ProtectedRoute>
      <ProfilePage />
    </ProtectedRoute>
  } 
/>
```

**工作流程**：

```
用户访问 /profile
    ↓
ProtectedRoute 检查登录状态
    ↓
├─ 已登录 ✅
│  └─ 显示 ProfilePage
│
└─ 未登录 ❌
   └─ 跳转到 /login
      └─ 记住原路径 /profile
         └─ 登录后跳回 /profile
```

**试一试**：
1. **未登录状态**：
   - 直接访问 `http://localhost:3000/profile`
   - 会自动跳转到 `/login`
   
2. **登录后**：
   - 在登录页输入任意用户名和密码
   - 点击登录
   - 自动跳转回 `/profile`

---

### 场景5️⃣: 在页面间传递数据

**方法1：通过 URL 参数**

```jsx
// 跳转时带上 ID
navigate(`/notes/${noteId}`);

// 接收时获取 ID
const { noteId } = useParams();
```

**方法2：通过 state 传递**

```jsx
// 跳转时传递数据
navigate('/success', {
  state: { 
    message: '保存成功！',
    noteId: 123
  }
});

// 接收时获取数据
import { useLocation } from 'react-router-dom';

function SuccessPage() {
  const location = useLocation();
  const message = location.state?.message;  // "保存成功！"
  const noteId = location.state?.noteId;    // 123
  
  return <div>{message}</div>;
}
```

**实际例子**：登录后跳转

```jsx
// LoginPage.jsx
const handleLogin = () => {
  // 保存登录状态
  localStorage.setItem('isLoggedIn', 'true');
  
  // 跳转时传递欢迎信息
  navigate('/profile', {
    state: { message: '登录成功！' }
  });
};

// ProfilePage.jsx
function ProfilePage() {
  const location = useLocation();
  const welcomeMessage = location.state?.message;
  
  return (
    <div>
      {welcomeMessage && <p>{welcomeMessage}</p>}
      {/* 其他内容 */}
    </div>
  );
}
```

---

## 实际场景示例

### 场景A：用户浏览笔记的完整流程

```
1️⃣ 用户打开应用
   → 自动显示首页 (/)
   → 看到笔记列表

2️⃣ 用户点击某个笔记标题
   → 调用 handleViewNote(noteId)
   → 执行 navigate(`/notes/${noteId}`)
   → URL 变为 /notes/123
   → 路由匹配到 <Route path="/notes/:id" />
   → 渲染 NoteDetailPage 组件
   → useParams() 获取 id = "123"
   → 从 localStorage 加载对应笔记
   → 显示笔记详情

3️⃣ 用户点击"编辑"按钮
   → 执行 navigate(`/edit/${id}`)
   → URL 变为 /edit/123
   → 路由匹配到 <Route path="/edit/:id" />
   → 渲染 EditNotePage 组件
   → 显示编辑表单

4️⃣ 用户修改内容并保存
   → 执行保存逻辑
   → 执行 navigate(`/notes/${id}`)
   → 跳转回详情页
   → 显示更新后的内容
```

**代码追踪**：

```jsx
// 1. HomePage.jsx - 定义跳转函数
const handleViewNote = (noteId) => {
  navigate(`/notes/${noteId}`);
};

// 传递给 NoteList
<NoteList onViewNote={handleViewNote} />

// 2. NoteList.jsx - 传递给 NoteItem
<NoteItem 
  note={note}
  onViewNote={onViewNote}
/>

// 3. NoteItem.jsx - 绑定到标题点击
<h3 onClick={() => onViewNote(note.id)}>
  {note.title}
</h3>

// 4. 用户点击标题
// → 触发 onViewNote(123)
// → 执行 navigate('/notes/123')
// → URL 变化
// → 路由系统渲染 NoteDetailPage
```

---

### 场景B：用户登录的完整流程

```
1️⃣ 用户未登录，尝试访问个人中心
   → 访问 /profile
   → ProtectedRoute 检测未登录
   → 自动跳转到 /login
   → 保存原路径 state={{ from: '/profile' }}

2️⃣ 用户在登录页输入信息
   → 填写用户名和密码
   → 点击"登录"按钮
   → 执行 handleLogin()
   → 保存登录状态到 localStorage
   → 获取原路径 location.state?.from
   → 执行 navigate(from)
   → 跳转回 /profile

3️⃣ 用户成功访问个人中心
   → 显示用户信息
   → 显示笔记统计
```

**代码追踪**：

```jsx
// 1. ProtectedRoute.jsx - 检查登录
function ProtectedRoute({ children }) {
  const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
  
  if (!isLoggedIn) {
    // 跳转到登录页，记住原路径
    return <Navigate 
      to="/login" 
      state={{ from: location }}
      replace 
    />;
  }
  
  return children;
}

// 2. LoginPage.jsx - 登录后跳转
function LoginPage() {
  const location = useLocation();
  const from = location.state?.from?.pathname || '/';
  
  const handleLogin = () => {
    localStorage.setItem('isLoggedIn', 'true');
    navigate(from, { replace: true });  // 跳转回原页面
  };
}
```

---

## 常见操作演示

### 操作1️⃣: 添加一个新页面

**需求**：添加一个"设置"页面

**步骤**：

```jsx
// 1️⃣ 创建页面组件
// src/pages/SettingsPage.jsx
function SettingsPage() {
  return (
    <div>
      <h1>⚙️ 设置</h1>
      <p>这是设置页面</p>
    </div>
  );
}
export default SettingsPage;

// 2️⃣ 在 AppRouter.jsx 中添加路由
import SettingsPage from '../pages/SettingsPage';

<Route path="/" element={<Layout />}>
  {/* 其他路由... */}
  <Route path="settings" element={<SettingsPage />} />
</Route>

// 3️⃣ 在导航栏添加链接（Layout.jsx）
<nav>
  <NavLink to="/">首页</NavLink>
  <NavLink to="/about">关于</NavLink>
  <NavLink to="/settings">设置</NavLink>  {/* 👈 新增 */}
</nav>
```

**测试**：
- 访问 `http://localhost:3000/settings`
- 或点击导航栏的"设置"链接

---

### 操作2️⃣: 让某个按钮跳转到其他页面

```jsx
import { useNavigate } from 'react-router-dom';

function MyComponent() {
  const navigate = useNavigate();
  
  return (
    <button onClick={() => navigate('/about')}>
      查看关于页面
    </button>
  );
}
```

---

### 操作3️⃣: 让某个链接根据条件跳转

```jsx
function MyComponent() {
  const navigate = useNavigate();
  const isLoggedIn = /* 检查登录状态 */;
  
  const handleClick = () => {
    if (isLoggedIn) {
      navigate('/profile');  // 已登录 → 个人中心
    } else {
      navigate('/login');    // 未登录 → 登录页
    }
  };
  
  return <button onClick={handleClick}>我的账户</button>;
}
```

---

### 操作4️⃣: 获取并显示当前页面的路径

```jsx
import { useLocation } from 'react-router-dom';

function MyComponent() {
  const location = useLocation();
  
  return (
    <div>
      <p>当前路径: {location.pathname}</p>
      <p>查询参数: {location.search}</p>
      <p>锚点: {location.hash}</p>
    </div>
  );
}

// 访问 /notes/123?sort=newest#comments
// 显示：
// 当前路径: /notes/123
// 查询参数: ?sort=newest
// 锚点: #comments
```

---

### 操作5️⃣: 在URL中添加查询参数

```jsx
import { useSearchParams } from 'react-router-dom';

function SearchPage() {
  const [searchParams, setSearchParams] = useSearchParams();
  
  // 读取查询参数
  const query = searchParams.get('q');        // "React"
  const sort = searchParams.get('sort');      // "newest"
  
  // 更新查询参数
  const handleSearch = (keyword) => {
    setSearchParams({ q: keyword, sort: 'newest' });
    // URL 变为 /search?q=keyword&sort=newest
  };
  
  return (
    <div>
      <p>搜索关键词: {query}</p>
      <button onClick={() => handleSearch('React')}>
        搜索 React
      </button>
    </div>
  );
}
```

---

## 🎯 实战练习

完成以下练习，巩固路由使用：

### 练习1：基础跳转
- [ ] 在首页添加一个按钮，点击跳转到关于页面
- [ ] 在关于页面添加一个"返回首页"按钮

### 练习2：动态路由
- [ ] 创建一个标签页面 `/tags/:tagName`
- [ ] 在首页的标签按钮上添加跳转功能
- [ ] 在标签页面显示该标签下的所有笔记

### 练习3：路由守卫
- [ ] 让设置页面需要登录才能访问
- [ ] 未登录时跳转到登录页
- [ ] 登录后自动跳回设置页面

### 练习4：数据传递
- [ ] 删除笔记后，跳转到首页并显示"删除成功"提示
- [ ] 3秒后自动隐藏提示

---

## 📝 总结

### 路由使用的三种方式

1. **浏览器直接访问** URL
   - 在地址栏输入路径
   - 点击收藏夹
   - 点击分享链接

2. **点击 Link 组件**
   - 导航栏链接
   - 笔记标题
   - 面包屑导航

3. **编程式导航 navigate()**
   - 按钮点击后跳转
   - 表单提交后跳转
   - 条件判断后跳转

### 核心 Hooks 使用场景

| Hook | 什么时候用 | 示例 |
|------|----------|------|
| `useNavigate` | 需要在代码中跳转 | 按钮点击、表单提交 |
| `useParams` | 需要获取URL参数 | 详情页、编辑页 |
| `useLocation` | 需要知道当前路径 | 面包屑、高亮导航 |
| `useSearchParams` | 需要查询参数 | 搜索、筛选、分页 |

### 记住这些要点

- ✅ 内部跳转用 `<Link>`，不要用 `<a>`
- ✅ `useParams()` 返回字符串，记得转换类型
- ✅ 路由守卫用于保护页面
- ✅ `navigate(-1)` 可以返回上一页
- ✅ 可以通过 state 传递临时数据

---

**🎉 现在你知道如何使用路由了！**

有任何疑问，随时查阅文档或提问！💪
