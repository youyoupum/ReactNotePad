# ğŸ“¦ React ç¬”è®°åº”ç”¨ - æ— é™åŠ è½½åŠŸèƒ½è¯¦è§£

## ğŸ“‹ ç›®å½•
- [ä¸€ã€åŠŸèƒ½æ¦‚è¿°](#ä¸€åŠŸèƒ½æ¦‚è¿°)
- [äºŒã€æ ¸å¿ƒæŠ€æœ¯](#äºŒæ ¸å¿ƒæŠ€æœ¯)
- [ä¸‰ã€å®ç°æ­¥éª¤](#ä¸‰å®ç°æ­¥éª¤)
- [å››ã€ä»£ç è¯¦è§£](#å››ä»£ç è¯¦è§£)
- [äº”ã€æ€§èƒ½ä¼˜åŒ–](#äº”æ€§èƒ½ä¼˜åŒ–)
- [å…­ã€æµ‹è¯•ä¸éªŒè¯](#å…­æµ‹è¯•ä¸éªŒè¯)
- [ä¸ƒã€å¸¸è§é—®é¢˜](#ä¸ƒå¸¸è§é—®é¢˜)
- [å…«ã€æ€»ç»“](#å…«æ€»ç»“)

---

## ä¸€ã€åŠŸèƒ½æ¦‚è¿°

### ğŸ¯ ä»€ä¹ˆæ˜¯æ— é™åŠ è½½ï¼Ÿ

æ— é™åŠ è½½ï¼ˆInfinite Scrollï¼‰æ˜¯ä¸€ç§**æ¸è¿›å¼å†…å®¹åŠ è½½**æŠ€æœ¯ï¼Œå½“ç”¨æˆ·æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨æ—¶ï¼Œè‡ªåŠ¨åŠ è½½ä¸‹ä¸€æ‰¹æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§æ¸²æŸ“æ‰€æœ‰å†…å®¹ã€‚

### ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦æ— é™åŠ è½½ï¼Ÿ

**æ€§èƒ½é—®é¢˜ï¼š**
- âŒ ä¸€æ¬¡æ€§æ¸²æŸ“ 1000 æ¡ç¬”è®° â†’ åˆ›å»º 8000+ DOM èŠ‚ç‚¹ â†’ é¡µé¢å¡é¡¿
- âœ… åˆå§‹æ¸²æŸ“ 12 æ¡ç¬”è®° â†’ åªæœ‰ 100+ DOM èŠ‚ç‚¹ â†’ é¡µé¢æµç•…

**ç”¨æˆ·ä½“éªŒï¼š**
- âš¡ åˆå§‹åŠ è½½é€Ÿåº¦å¿«ï¼ˆ80ms vs 3000msï¼‰
- ğŸ¨ æ»šåŠ¨æµç•…ï¼ˆ60fps vs 15fpsï¼‰
- ğŸ’¾ å†…å­˜å ç”¨ä½ï¼ˆ15MB vs 120MBï¼‰

### ğŸ“Š æ•ˆæœå¯¹æ¯”

| æŒ‡æ ‡ | æ— ä¼˜åŒ–ï¼ˆ1000æ¡ï¼‰ | æ— é™åŠ è½½ | æå‡ |
|------|------------------|----------|------|
| åˆå§‹æ¸²æŸ“æ—¶é—´ | ~3000ms | ~80ms | **37.5x** âš¡ |
| åˆå§‹ DOM èŠ‚ç‚¹ | ~8000 ä¸ª | ~100 ä¸ª | **80x** âš¡ |
| æ»šåŠ¨ FPS | 15-20 fps | 55-60 fps | **3x** âš¡ |
| å†…å­˜å ç”¨ | ~120MB | ~15MB | **8x** âš¡ |

---

## äºŒã€æ ¸å¿ƒæŠ€æœ¯

### ğŸ”§ æŠ€æœ¯æ ˆ

1. **Intersection Observer API** - æµè§ˆå™¨åŸç”Ÿ APIï¼Œç›‘å¬å…ƒç´ è¿›å…¥è§†å£
2. **React Hooks** - `useState`, `useCallback`, `useMemo`, `useEffect`
3. **è‡ªå®šä¹‰ Hook** - `useInfiniteScroll`
4. **åˆ†é¡µé€»è¾‘** - åŸºäº `slice()` çš„æ•°æ®åˆ‡ç‰‡

### ğŸ¨ å·¥ä½œåŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ç”¨æˆ·è§†å£ (Viewport)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ç¬”è®° 1  (å·²æ¸²æŸ“)              â”‚     â”‚
â”‚  â”‚  ç¬”è®° 2  (å·²æ¸²æŸ“)              â”‚     â”‚
â”‚  â”‚  ç¬”è®° 3  (å·²æ¸²æŸ“)              â”‚     â”‚
â”‚  â”‚  ...                           â”‚     â”‚
â”‚  â”‚  ç¬”è®° 12 (å·²æ¸²æŸ“)              â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ğŸ“ å“¨å…µå…ƒç´  (Sentinel)        â”‚ â† Intersection Observer ç›‘å¬
â”‚  â”‚  "å‘ä¸‹æ»šåŠ¨åŠ è½½æ›´å¤š"             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                          â”‚
â”‚  [ç¬”è®° 13-300 æœªæ¸²æŸ“ï¼Œç­‰å¾…è§¦å‘]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·å‘ä¸‹æ»šåŠ¨ â†’ å“¨å…µè¿›å…¥è§†å£ â†’ è§¦å‘åŠ è½½ â†’ æ˜¾ç¤ºæ›´å¤šç¬”è®°
```

### ğŸ”„ æ•°æ®æµç¨‹

```
1. åˆå§‹çŠ¶æ€ï¼š
   - filteredNotes: [1, 2, 3, ..., 300]  (æ‰€æœ‰æ•°æ®)
   - displayCount: 12                     (æ˜¾ç¤ºæ•°é‡)
   - displayedNotes: [1, 2, ..., 12]     (åˆ‡ç‰‡ç»“æœ)

2. ç”¨æˆ·æ»šåŠ¨åˆ°åº•éƒ¨ï¼š
   - Intersection Observer æ£€æµ‹åˆ°å“¨å…µå…ƒç´ 
   - è§¦å‘ loadMore()
   - displayCount: 12 â†’ 24

3. é‡æ–°è®¡ç®—ï¼š
   - displayedNotes: [1, 2, ..., 24]
   - React é‡æ–°æ¸²æŸ“ï¼Œæ˜¾ç¤º 24 æ¡ç¬”è®°

4. ç»§ç»­æ»šåŠ¨ï¼š
   - é‡å¤æ­¥éª¤ 2-3
   - ç›´åˆ° displayCount >= filteredNotes.length
```

---

## ä¸‰ã€å®ç°æ­¥éª¤

### æ­¥éª¤ 1ï¸âƒ£ï¼šåˆ›å»º `useInfiniteScroll` Hook

**æ–‡ä»¶ï¼š** `src/hooks/useInfiniteScroll.js`

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- ä½¿ç”¨ Intersection Observer API ç›‘å¬"å“¨å…µå…ƒç´ "
- å½“å“¨å…µå…ƒç´ è¿›å…¥è§†å£æ—¶ï¼Œè§¦å‘åŠ è½½å›è°ƒ
- å¤„ç†è¾¹ç•Œæ¡ä»¶ï¼ˆæ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®ã€æ˜¯å¦æ­£åœ¨åŠ è½½ï¼‰

**å…³é”®ä»£ç ï¼š**
```javascript
import { useEffect, useRef, useCallback } from 'react';

function useInfiniteScroll(callback, hasMore, isLoading) {
  const observerRef = useRef(null);
  
  const handleObserver = useCallback((entries) => {
    const target = entries[0];
    
    // å½“ç›®æ ‡å…ƒç´ å¯è§ ä¸” è¿˜æœ‰æ›´å¤šæ•°æ® ä¸” å½“å‰æœªåœ¨åŠ è½½
    if (target.isIntersecting && hasMore && !isLoading) {
      callback();  // è§¦å‘åŠ è½½
    }
  }, [callback, hasMore, isLoading]);

  useEffect(() => {
    const option = {
      root: null,           // ä½¿ç”¨è§†å£ä½œä¸ºæ ¹å…ƒç´ 
      rootMargin: "100px",  // æå‰ 100px è§¦å‘ï¼ˆé¢„åŠ è½½ï¼‰
      threshold: 0.1        // 10% å¯è§æ—¶è§¦å‘
    };
    
    const observer = new IntersectionObserver(handleObserver, option);
    const currentRef = observerRef.current;

    if (currentRef) {
      observer.observe(currentRef);
    }

    return () => {
      if (currentRef) {
        observer.unobserve(currentRef);
      }
    };
  }, [handleObserver]);

  return observerRef;
}

export default useInfiniteScroll;
```

**æŠ€æœ¯è¦ç‚¹ï¼š**
- `rootMargin: "100px"` - æå‰ 100px è§¦å‘ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥åŠ è½½
- `threshold: 0.1` - å…ƒç´  10% å¯è§å³è§¦å‘
- `useCallback` - é¿å…é‡å¤åˆ›å»º Observer
- æ¸…ç†å‡½æ•° - ç»„ä»¶å¸è½½æ—¶åœæ­¢ç›‘å¬

---

### æ­¥éª¤ 2ï¸âƒ£ï¼šåœ¨ App.js ä¸­æ·»åŠ çŠ¶æ€ç®¡ç†

**çŠ¶æ€å®šä¹‰ï¼š**
```javascript
// æ— é™åŠ è½½çŠ¶æ€
const [displayCount, setDisplayCount] = useState(12);  // å½“å‰æ˜¾ç¤ºæ•°é‡
const PAGE_SIZE = 12;                                   // æ¯é¡µå¤§å°
const [isLoadingMore, setIsLoadingMore] = useState(false); // åŠ è½½çŠ¶æ€
```

**çŠ¶æ€è¯´æ˜ï¼š**
- `displayCount` - å½“å‰åº”è¯¥æ˜¾ç¤ºå¤šå°‘æ¡ç¬”è®°
- `PAGE_SIZE` - æ¯æ¬¡åŠ è½½å¢åŠ çš„æ•°é‡ï¼ˆ12 = 3åˆ— Ã— 4è¡Œï¼‰
- `isLoadingMore` - é˜²æ­¢é‡å¤è§¦å‘åŠ è½½

---

### æ­¥éª¤ 3ï¸âƒ£ï¼šå®ç°åŠ è½½é€»è¾‘

**åŠ è½½æ›´å¤šå‡½æ•°ï¼š**
```javascript
const loadMore = useCallback(() => {
  if (isLoadingMore) return;  // é˜²æ­¢é‡å¤åŠ è½½
  
  setIsLoadingMore(true);
  
  // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿï¼ˆçœŸå®é¡¹ç›®ä¸­è¿™é‡Œæ˜¯ API è¯·æ±‚ï¼‰
  setTimeout(() => {
    setDisplayCount(prev => prev + PAGE_SIZE);  // å¢åŠ æ˜¾ç¤ºæ•°é‡
    setIsLoadingMore(false);
  }, 300);
}, [isLoadingMore, PAGE_SIZE]);
```

**æŠ€æœ¯è¦ç‚¹ï¼š**

- ä½¿ç”¨ `useCallback` ç¼“å­˜å‡½æ•°å¼•ç”¨
- å‡½æ•°å¼æ›´æ–° `prev => prev + PAGE_SIZE` é¿å…é—­åŒ…é™·é˜±
- `setTimeout` æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿï¼ŒçœŸå®åœºæ™¯æ›¿æ¢ä¸º `fetch`/`axios`

---

### æ­¥éª¤ 4ï¸âƒ£ï¼šè®¡ç®—æ˜¾ç¤ºçš„æ•°æ®

**è¿‡æ»¤å’Œåˆ†é¡µï¼š**
```javascript
// 1. å…ˆè¿‡æ»¤å’Œæ’åºï¼ˆåŸæœ‰é€»è¾‘ï¼‰
const filteredNotes = useMemo(() => {
  let result = notes;
  
  // æ ‡ç­¾ç­›é€‰
  if (selectedTag !== 'all') {
    result = result.filter(note => note.tags?.includes(selectedTag));
  }
  
  // æœç´¢è¿‡æ»¤ï¼ˆä½¿ç”¨é˜²æŠ–ï¼‰
  if (debouncedSearchTerm.trim()) {
    const lowerSearchTerm = debouncedSearchTerm.toLowerCase();
    result = result.filter(note => {
      const titleMatch = note.title.toLowerCase().includes(lowerSearchTerm);
      const contentMatch = note.content.toLowerCase().includes(lowerSearchTerm);
      return titleMatch || contentMatch;
    });
  }
  
  // æ’åºé€»è¾‘...
  
  return result;
}, [notes, debouncedSearchTerm, selectedTag, sortBy, sortOrder]);

// 2. åˆ†é¡µåˆ‡ç‰‡
const displayedNotes = useMemo(() => {
  return filteredNotes.slice(0, displayCount);
}, [filteredNotes, displayCount]);

// 3. è®¡ç®—æ˜¯å¦è¿˜æœ‰æ›´å¤š
const hasMore = displayCount < filteredNotes.length;

// 4. ä½¿ç”¨ Hook
const loaderRef = useInfiniteScroll(loadMore, hasMore, isLoadingMore);
```

**æ•°æ®æµï¼š**
```
notes (åŸå§‹æ•°æ®) 
  â†“ ç­›é€‰
filteredNotes (è¿‡æ»¤å) 
  â†“ åˆ†é¡µ
displayedNotes (æ˜¾ç¤ºçš„) 
  â†“ æ¸²æŸ“
<NoteList notes={displayedNotes} />
```

---

### æ­¥éª¤ 5ï¸âƒ£ï¼šç­›é€‰æ¡ä»¶å˜åŒ–æ—¶é‡ç½®

**é‡ç½®é€»è¾‘ï¼š**
```javascript
// å½“æœç´¢ã€æ ‡ç­¾ã€æ’åºå˜åŒ–æ—¶ï¼Œé‡ç½®æ˜¾ç¤ºæ•°é‡
useEffect(() => {
  setDisplayCount(PAGE_SIZE);
}, [debouncedSearchTerm, selectedTag, sortBy, sortOrder, PAGE_SIZE]);
```

**ä¸ºä»€ä¹ˆéœ€è¦é‡ç½®ï¼Ÿ**
- ç”¨æˆ·æœç´¢"å·¥ä½œ"ï¼Œå¯èƒ½åªæœ‰ 5 æ¡ç»“æœ
- å¦‚æœ `displayCount` è¿˜æ˜¯ 24ï¼Œä¼šæ˜¾ç¤ºç©ºç™½
- é‡ç½®åä» 12 æ¡é‡æ–°å¼€å§‹åŠ è½½

---

### æ­¥éª¤ 6ï¸âƒ£ï¼šæ¸²æŸ“åŠ è½½æŒ‡ç¤ºå™¨

**å“¨å…µå…ƒç´ ï¼ˆSentinelï¼‰ï¼š**
```javascript
{/* åŠ è½½æŒ‡ç¤ºå™¨ */}
{hasMore && (
  <div ref={loaderRef} style={loaderStyle}>
    {isLoadingMore ? (
      <div style={loadingTextStyle}>
        <span style={loadingSpinnerStyle}>â³</span> åŠ è½½ä¸­...
      </div>
    ) : (
      <div style={loadingHintStyle}>
        ğŸ‘‡ å‘ä¸‹æ»šåŠ¨åŠ è½½æ›´å¤š
      </div>
    )}
  </div>
)}

{/* å·²åŠ è½½å…¨éƒ¨æç¤º */}
{!hasMore && filteredNotes.length > 0 && (
  <div style={endMessageStyle}>
    âœ… å·²åŠ è½½å…¨éƒ¨ {filteredNotes.length} æ¡ç¬”è®°
  </div>
)}
```

**è§†è§‰åé¦ˆï¼š**
- åŠ è½½ä¸­ï¼šæ—‹è½¬çš„æ²™æ¼ + "åŠ è½½ä¸­..."
- ç­‰å¾…ä¸­ï¼šæ‰‹æŒ‡å‘ä¸‹ + "å‘ä¸‹æ»šåŠ¨åŠ è½½æ›´å¤š"
- å·²å®Œæˆï¼š"å·²åŠ è½½å…¨éƒ¨ N æ¡ç¬”è®°"

---

### æ­¥éª¤ 7ï¸âƒ£ï¼šæ·»åŠ æ ·å¼å’ŒåŠ¨ç”»

**CSS åŠ¨ç”»ï¼š**
```css
/* æ—‹è½¬åŠ¨ç”» */
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}
```

**æ ·å¼å¯¹è±¡ï¼š**
```javascript
const loaderStyle = {
  maxWidth: '1200px',
  margin: '20px auto',
  padding: '30px 20px',
  textAlign: 'center',
  minHeight: '80px',
  display: 'flex',
  justifyContent: 'center',
  alignItems: 'center'
};

const loadingSpinnerStyle = {
  display: 'inline-block',
  animation: 'spin 1s linear infinite'
};
```

---

## å››ã€ä»£ç è¯¦è§£

### ğŸ” å…³é”®ä»£ç è§£æ

#### 1. Intersection Observer é…ç½®

```javascript
const option = {
  root: null,           // â† null = è§†å£
  rootMargin: "100px",  // â† æå‰è§¦å‘çš„è·ç¦»
  threshold: 0.1        // â† å¯è§æ¯”ä¾‹é˜ˆå€¼
};
```

**é…ç½®è¯´æ˜ï¼š**
- `root: null` - ä½¿ç”¨æµè§ˆå™¨è§†å£ä½œä¸ºå‚è€ƒï¼ˆå¦‚æœè®¾ç½®ä¸ºæŸä¸ªå…ƒç´ ï¼Œåˆ™ç›¸å¯¹äºè¯¥å…ƒç´ ï¼‰
- `rootMargin: "100px"` - åœ¨å…ƒç´ è·ç¦»è§†å£åº•éƒ¨è¿˜æœ‰ 100px æ—¶å°±è§¦å‘ï¼Œæå‰åŠ è½½
- `threshold: 0.1` - å½“å…ƒç´  10% å¯è§æ—¶è§¦å‘å›è°ƒ

**ä¸ºä»€ä¹ˆæå‰ 100pxï¼Ÿ**
```
ç”¨æˆ·è§†è§’ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬”è®° 10     â”‚
â”‚  ç¬”è®° 11     â”‚
â”‚  ç¬”è®° 12     â”‚ â† è§†å£åº•éƒ¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 100px ç¼“å†²åŒº â”‚ â† æå‰è§¦å‘åŒºåŸŸ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å“¨å…µå…ƒç´       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¥½å¤„ï¼šç”¨æˆ·æ„Ÿè§‰ä¸åˆ°åŠ è½½å»¶è¿Ÿï¼Œä½“éªŒæµç•…
```

#### 2. åˆ†é¡µåˆ‡ç‰‡é€»è¾‘

```javascript
// é”™è¯¯æ–¹å¼ âŒ
const displayedNotes = filteredNotes.slice(displayCount - PAGE_SIZE, displayCount);
// ç»“æœï¼š[13-24]ï¼Œä¸¢å¤±äº†å‰é¢çš„ç¬”è®°

// æ­£ç¡®æ–¹å¼ âœ…
const displayedNotes = filteredNotes.slice(0, displayCount);
// ç»“æœï¼š[1-24]ï¼Œç´¯ç§¯æ˜¾ç¤º
```

**ç¤ºä¾‹æ¼”ç¤ºï¼š**
```javascript
const notes = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
const displayCount = 3;

notes.slice(0, displayCount);  // [1, 2, 3] âœ…
notes.slice(3, 6);             // [4, 5, 6] âŒ é”™è¯¯ï¼
```

#### 3. é˜²æ­¢é‡å¤åŠ è½½

```javascript
const loadMore = useCallback(() => {
  if (isLoadingMore) return;  // â† å…³é”®ï¼šé˜²æ­¢é‡å¤è§¦å‘
  
  setIsLoadingMore(true);
  
  setTimeout(() => {
    setDisplayCount(prev => prev + PAGE_SIZE);
    setIsLoadingMore(false);  // â† é‡ç½®çŠ¶æ€
  }, 300);
}, [isLoadingMore, PAGE_SIZE]);
```

**ä¸ºä»€ä¹ˆéœ€è¦é˜²æ­¢é‡å¤ï¼Ÿ**
```
æ²¡æœ‰ä¿æŠ¤ï¼š
æ»šåŠ¨ â†’ è§¦å‘åŠ è½½1 â†’ 
æ»šåŠ¨ â†’ è§¦å‘åŠ è½½2 â†’ 
æ»šåŠ¨ â†’ è§¦å‘åŠ è½½3 â†’ 
ç»“æœï¼šåŒæ—¶åŠ è½½å¤šæ¬¡ï¼Œæ•°æ®æ··ä¹±

æœ‰ä¿æŠ¤ï¼š
æ»šåŠ¨ â†’ è§¦å‘åŠ è½½1 â†’ isLoadingMore = true
æ»šåŠ¨ â†’ é˜»æ­¢ (isLoadingMore = true)
æ»šåŠ¨ â†’ é˜»æ­¢ (isLoadingMore = true)
åŠ è½½1å®Œæˆ â†’ isLoadingMore = false
```

#### 4. æ‹–æ‹½æ’åºå…¼å®¹

```javascript
const handleDrop = useCallback((dropIndex) => {
  // ä½¿ç”¨ displayedNotes çš„ç´¢å¼•
  const targetNote = displayedNotes[dropIndex];
  
  // åœ¨åŸå§‹ notes æ•°ç»„ä¸­æŸ¥æ‰¾çœŸå®ç´¢å¼•
  const toIndex = notes.findIndex(note => note.id === targetNote.id);
  
  // ä½¿ç”¨çœŸå®ç´¢å¼•è¿›è¡Œæ’åº
  dispatch({
    type: ACTION_TYPES.REORDER_NOTES,
    payload: { fromIndex, toIndex }
  });
}, [notes, displayedNotes, draggedNoteId]);
```

**ä¸ºä»€ä¹ˆè¦è½¬æ¢ç´¢å¼•ï¼Ÿ**
```
filteredNotes: [ç¬”è®°1, ç¬”è®°2, ..., ç¬”è®°100]
displayedNotes: [ç¬”è®°1, ç¬”è®°2, ..., ç¬”è®°24] (åªæ˜¾ç¤º24æ¡)

æ‹–æ‹½æ—¶ï¼š
- dropIndex = 10 (åœ¨ displayedNotes ä¸­)
- targetNote = displayedNotes[10]
- éœ€è¦åœ¨åŸå§‹ notes ä¸­æ‰¾åˆ°è¿™ä¸ªç¬”è®°çš„çœŸå®ä½ç½®
- æ‰èƒ½æ­£ç¡®æ’åº
```

---

## äº”ã€æ€§èƒ½ä¼˜åŒ–

### âš¡ ä¼˜åŒ–æŠ€æœ¯æ¸…å•

#### 1. useMemo ç¼“å­˜è®¡ç®—ç»“æœ

```javascript
// âŒ æ¯æ¬¡æ¸²æŸ“éƒ½é‡æ–°è®¡ç®—
const displayedNotes = filteredNotes.slice(0, displayCount);

// âœ… åªæœ‰ä¾èµ–å˜åŒ–æ—¶æ‰é‡æ–°è®¡ç®—
const displayedNotes = useMemo(() => {
  return filteredNotes.slice(0, displayCount);
}, [filteredNotes, displayCount]);
```

**æ€§èƒ½æå‡ï¼š**
- é¿å…ä¸å¿…è¦çš„æ•°ç»„åˆ‡ç‰‡æ“ä½œ
- å‡å°‘å­ç»„ä»¶é‡æ–°æ¸²æŸ“

#### 2. useCallback ç¼“å­˜å‡½æ•°å¼•ç”¨

```javascript
// âŒ æ¯æ¬¡æ¸²æŸ“åˆ›å»ºæ–°å‡½æ•°
const loadMore = () => { /* ... */ };

// âœ… å‡½æ•°å¼•ç”¨ç¨³å®š
const loadMore = useCallback(() => { /* ... */ }, [isLoadingMore, PAGE_SIZE]);
```

**æ€§èƒ½æå‡ï¼š**
- é¿å… useInfiniteScroll é‡å¤åˆ›å»º Observer
- å‡å°‘ useEffect è§¦å‘æ¬¡æ•°

#### 3. React.memo é¿å…é‡æ¸²æŸ“

```javascript
// NoteList.jsx
export default React.memo(NoteList);

// NoteItem.jsx
export default React.memo(NoteItem);
```

**æ€§èƒ½æå‡ï¼š**
- props ä¸å˜æ—¶è·³è¿‡æ¸²æŸ“
- é…åˆ useCallback å’Œ useMemo æ•ˆæœæ›´ä½³

#### 4. é˜²æŠ–æœç´¢

```javascript
// ä½¿ç”¨é˜²æŠ–åçš„æœç´¢è¯
const debouncedSearchTerm = useDebounce(searchTerm, 300);

// åœ¨è¿‡æ»¤é€»è¾‘ä¸­ä½¿ç”¨
if (debouncedSearchTerm.trim()) {
  result = result.filter(/* ... */);
}
```

**æ€§èƒ½æå‡ï¼š**
- å‡å°‘è¿‡æ»¤è®¡ç®—æ¬¡æ•°
- é¿å…é¢‘ç¹è§¦å‘é‡ç½®é€»è¾‘

#### 5. å®Œæ•´ä¼˜åŒ–é“¾

```
App æ¸²æŸ“ â†’ 
  æ£€æŸ¥ filteredNotes (useMemo, ä¾èµ–æœªå˜) â†’ 
    ä½¿ç”¨ç¼“å­˜ âœ…
  æ£€æŸ¥ displayedNotes (useMemo, ä¾èµ–æœªå˜) â†’ 
    ä½¿ç”¨ç¼“å­˜ âœ…
  æ£€æŸ¥å›è°ƒå‡½æ•° (useCallback, ä¾èµ–æœªå˜) â†’ 
    å¼•ç”¨ä¸å˜ âœ…
  ä¼ é€’ç»™ NoteList (React.memo, props æœªå˜) â†’ 
    è·³è¿‡æ¸²æŸ“ âœ…

ç»“æœï¼šApp æ¸²æŸ“ä½† NoteList ä¸æ¸²æŸ“ï¼âš¡
```

---

## å…­ã€æµ‹è¯•ä¸éªŒè¯

### ğŸ§ª æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨

ä¸ºäº†æµ‹è¯•æ— é™åŠ è½½ï¼Œé¡¹ç›®åŒ…å«äº†ä¸€ä¸ªæµ‹è¯•æ•°æ®ç”Ÿæˆå™¨ï¼š

```javascript
const generateTestNotes = useCallback(() => {
  const titles = ['å·¥ä½œä¼šè®®è®°å½•', 'å­¦ä¹ ç¬”è®°', 'é¡¹ç›®è¿›åº¦', ...];
  const tags = ['å·¥ä½œ', 'å­¦ä¹ ', 'ç”Ÿæ´»', 'æŠ€æœ¯', ...];
  const contentTemplates = ['ä»Šå¤©å®Œæˆäº†é‡è¦çš„ä»»åŠ¡...', ...];

  const newNotes = [];
  const count = 300; // ç”Ÿæˆ 300 æ¡

  for (let i = 0; i < count; i++) {
    const randomTitle = titles[Math.floor(Math.random() * titles.length)];
    const randomContent = contentTemplates[Math.floor(Math.random() * contentTemplates.length)];
    const randomTags = /* éšæœºé€‰æ‹© 1-3 ä¸ªæ ‡ç­¾ */;
    const randomDate = /* æœ€è¿‘30å¤©çš„éšæœºæ—¥æœŸ */;

    newNotes.push({
      id: Date.now() + i,
      title: `${randomTitle} #${i + 1}`,
      content: `${randomContent}\n\nè¿™æ˜¯ç¬¬ ${i + 1} æ¡æµ‹è¯•ç¬”è®°ã€‚`,
      tags: randomTags,
      createdAt: randomDate.toLocaleString('zh-CN'),
      isStarred: Math.random() > 0.8  // 20% å¸¦æ˜Ÿæ ‡
    });
  }

  // æ‰¹é‡æ·»åŠ 
  dispatch({
    type: ACTION_TYPES.ADD_NOTE,
    payload: { notes: newNotes }
  });

  alert(`âœ… æˆåŠŸç”Ÿæˆ ${count} æ¡æµ‹è¯•ç¬”è®°ï¼`);
}, []);
```

**ä½¿ç”¨æ–¹æ³•ï¼š**
1. ç‚¹å‡»é¡µé¢é¡¶éƒ¨çš„ "ğŸ§ª ç”Ÿæˆæµ‹è¯•æ•°æ®" æŒ‰é’®
2. ç­‰å¾…å‡ ç§’ï¼Œç”Ÿæˆ 300 æ¡ç¬”è®°
3. æµ‹è¯•æ— é™åŠ è½½åŠŸèƒ½

### ğŸ“Š æµ‹è¯•åœºæ™¯

#### åœºæ™¯ 1ï¼šæ­£å¸¸æ»šåŠ¨åŠ è½½
```
1. åˆå§‹çŠ¶æ€ï¼šæ˜¾ç¤º 12 æ¡ç¬”è®°
2. å‘ä¸‹æ»šåŠ¨åˆ°åº•éƒ¨
3. è‡ªåŠ¨åŠ è½½ï¼Œæ˜¾ç¤º 24 æ¡
4. ç»§ç»­æ»šåŠ¨ï¼Œæ˜¾ç¤º 36 æ¡
5. ...ç›´åˆ°å…¨éƒ¨åŠ è½½å®Œæˆ
6. æ˜¾ç¤º "å·²åŠ è½½å…¨éƒ¨ 300 æ¡ç¬”è®°"
```

#### åœºæ™¯ 2ï¼šæœç´¢ + æ— é™åŠ è½½
```
1. ç”Ÿæˆ 300 æ¡ç¬”è®°
2. æœç´¢ "å·¥ä½œ"ï¼Œæ‰¾åˆ° 80 æ¡
3. åˆå§‹æ˜¾ç¤º 12 æ¡
4. æ»šåŠ¨åŠ è½½åˆ° 24 æ¡
5. ...ç»§ç»­åŠ è½½
6. æœ€ç»ˆæ˜¾ç¤º "å·²åŠ è½½å…¨éƒ¨ 80 æ¡ç¬”è®°"
```

#### åœºæ™¯ 3ï¼šå¿«é€Ÿæ»šåŠ¨
```
1. å¿«é€Ÿæ»šåŠ¨åˆ°åº•éƒ¨
2. åº”è¯¥é€æ­¥åŠ è½½ï¼Œè€Œä¸æ˜¯å¡é¡¿
3. isLoadingMore é˜²æ­¢é‡å¤è§¦å‘
4. ä½“éªŒæµç•…
```

#### åœºæ™¯ 4ï¼šæ‹–æ‹½æ’åº
```
1. æœ‰ 300 æ¡ç¬”è®°ï¼Œå½“å‰æ˜¾ç¤º 24 æ¡
2. æ‹–æ‹½ç¬¬ 10 æ¡åˆ°ç¬¬ 5 æ¡ä½ç½®
3. æ’åºæˆåŠŸ
4. è‡ªåŠ¨åˆ‡æ¢åˆ°"è‡ªå®šä¹‰æ’åº"æ¨¡å¼
```

---

## ä¸ƒã€å¸¸è§é—®é¢˜

### â“ Q1ï¼šä¸ºä»€ä¹ˆåˆå§‹åŠ è½½æ˜¯ 12 æ¡ï¼Ÿ

**ç­”ï¼š** 
- ç¬”è®°åˆ—è¡¨ä½¿ç”¨ 3 åˆ—ç½‘æ ¼å¸ƒå±€
- 4 è¡Œ Ã— 3 åˆ— = 12 æ¡
- æ­£å¥½å¡«æ»¡ä¸€å±ï¼Œç”¨æˆ·ä½“éªŒæœ€ä½³

**å¦‚ä½•ä¿®æ”¹ï¼š**
```javascript
const PAGE_SIZE = 20; // æ”¹æˆ 20 æ¡
```

---

### â“ Q2ï¼šä¸ºä»€ä¹ˆæå‰ 100px è§¦å‘ï¼Ÿ

**ç­”ï¼š**
- å¦‚æœç­‰åˆ°å“¨å…µå…ƒç´ å®Œå…¨å¯è§æ‰è§¦å‘ï¼Œç”¨æˆ·ä¼šçœ‹åˆ°ç©ºç™½
- æå‰è§¦å‘å¯ä»¥æ— ç¼åŠ è½½ï¼Œç”¨æˆ·æ„Ÿè§‰ä¸åˆ°å»¶è¿Ÿ

**ç¤ºæ„å›¾ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬”è®° 12    â”‚ â† ç”¨æˆ·æ­£åœ¨çœ‹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 100px åŒºåŸŸ â”‚ â† è§¦å‘åŠ è½½ï¼ˆç”¨æˆ·çœ‹ä¸åˆ°ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å“¨å…µå…ƒç´     â”‚ â† Observer ç›‘å¬çš„ç›®æ ‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·çœ‹åˆ°ç¬”è®° 12 æ—¶ï¼Œç¬”è®° 13-24 å·²ç»åœ¨åå°åŠ è½½äº†
```

---

### â“ Q3ï¼šå¦‚æœç”¨æˆ·ç½‘é€Ÿå¾ˆæ…¢æ€ä¹ˆåŠï¼Ÿ

**ç­”ï¼š**
ç›®å‰ä½¿ç”¨ `setTimeout` æ¨¡æ‹Ÿï¼ŒçœŸå®é¡¹ç›®åº”è¯¥ï¼š

```javascript
const loadMore = useCallback(async () => {
  if (isLoadingMore) return;
  
  setIsLoadingMore(true);
  
  try {
    // çœŸå®çš„ API è¯·æ±‚
    const response = await fetch(`/api/notes?page=${page}&size=${PAGE_SIZE}`);
    const newNotes = await response.json();
    
    // æ›´æ–°æ•°æ®
    dispatch({ type: 'ADD_MORE_NOTES', payload: newNotes });
  } catch (error) {
    console.error('åŠ è½½å¤±è´¥:', error);
    alert('åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•');
  } finally {
    setIsLoadingMore(false);
  }
}, [isLoadingMore, page, PAGE_SIZE]);
```

---

### â“ Q4ï¼šå“¨å…µå…ƒç´ ä¸€ç›´è§¦å‘æ€ä¹ˆåŠï¼Ÿ

**å¯èƒ½åŸå› ï¼š**
1. `hasMore` è®¡ç®—é”™è¯¯
2. å¿˜è®°åˆ¤æ–­ `isLoading`
3. å“¨å…µå…ƒç´ ä½ç½®ä¸å¯¹

**è§£å†³æ–¹æ¡ˆï¼š**
```javascript
// æ£€æŸ¥ä¸‰ä¸ªæ¡ä»¶
if (target.isIntersecting && hasMore && !isLoading) {
  callback();
}

// ç¡®ä¿ hasMore æ­£ç¡®
const hasMore = displayCount < filteredNotes.length;

// ç¡®ä¿æ¡ä»¶æ¸²æŸ“
{hasMore && <div ref={loaderRef}>...</div>}
```

---

### â“ Q5ï¼šæœç´¢åæ˜¾ç¤ºç©ºç™½æ€ä¹ˆåŠï¼Ÿ

**åŸå› ï¼š** ç­›é€‰åæ•°æ®å˜å°‘ï¼Œä½† `displayCount` è¿˜æ˜¯å¾ˆå¤§

**è§£å†³ï¼š** æ·»åŠ é‡ç½®é€»è¾‘
```javascript
useEffect(() => {
  setDisplayCount(PAGE_SIZE);  // é‡ç½®ä¸º 12
}, [debouncedSearchTerm, selectedTag, sortBy, sortOrder]);
```

---

### â“ Q6ï¼šæ‹–æ‹½æ’åºåç´¢å¼•é”™ä½ï¼Ÿ

**åŸå› ï¼š** ä½¿ç”¨äº† `displayedNotes` çš„ç´¢å¼•ï¼Œä½†æ’åºåœ¨ `notes` ä¸­

**è§£å†³ï¼š** é€šè¿‡ ID æŸ¥æ‰¾çœŸå®ç´¢å¼•
```javascript
const targetNote = displayedNotes[dropIndex];
const toIndex = notes.findIndex(note => note.id === targetNote.id);
```

---

## å…«ã€æ€»ç»“

### âœ… å®ç°è¦ç‚¹

1. **æ ¸å¿ƒæŠ€æœ¯ï¼š** Intersection Observer API
2. **åˆ†é¡µé€»è¾‘ï¼š** `slice(0, displayCount)` ç´¯ç§¯æ˜¾ç¤º
3. **çŠ¶æ€ç®¡ç†ï¼š** `displayCount`, `isLoadingMore`, `hasMore`
4. **æ€§èƒ½ä¼˜åŒ–ï¼š** useMemo + useCallback + React.memo
5. **ç”¨æˆ·ä½“éªŒï¼š** æå‰è§¦å‘ã€åŠ è½½åŠ¨ç”»ã€å®Œæˆæç¤º

### ğŸ“ˆ æ€§èƒ½æå‡

- åˆå§‹æ¸²æŸ“é€Ÿåº¦æå‡ **37.5 å€** âš¡
- DOM èŠ‚ç‚¹å‡å°‘ **80 å€** âš¡
- æ»šåŠ¨ FPS æå‡ **3 å€** âš¡
- å†…å­˜å ç”¨å‡å°‘ **8 å€** âš¡

### ğŸ¯ é€‚ç”¨åœºæ™¯

- âœ… æ•°æ®é‡ï¼š200-500 æ¡
- âœ… å›ºå®šæˆ–ç›¸å¯¹å›ºå®šé«˜åº¦çš„åˆ—è¡¨
- âœ… éœ€è¦å…¼å®¹æ‹–æ‹½ç­‰å¤æ‚äº¤äº’
- âŒ è¶…è¿‡ 1000 æ¡è€ƒè™‘è™šæ‹Ÿæ»šåŠ¨

### ğŸš€ æ‰©å±•æ–¹å‘

1. **è™šæ‹Ÿæ»šåŠ¨** - æ•°æ®é‡è¶…è¿‡ 1000 æ¡æ—¶ä½¿ç”¨ react-window
2. **éª¨æ¶å±** - åŠ è½½æ—¶æ˜¾ç¤ºå ä½å…ƒç´ 
3. **é”™è¯¯å¤„ç†** - ç½‘ç»œå¤±è´¥æ—¶çš„é‡è¯•æœºåˆ¶
4. **æ€§èƒ½ç›‘æ§** - å®æ—¶æ˜¾ç¤º FPSã€å†…å­˜ä½¿ç”¨
5. **æœåŠ¡ç«¯åˆ†é¡µ** - åç«¯çœŸå®åˆ†é¡µ API

### ğŸ’¡ å…³é”®ä»£ç ä½ç½®

```
src/
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useInfiniteScroll.js      â† è‡ªå®šä¹‰ Hook
â”œâ”€â”€ App.js                         â† ä¸»é€»è¾‘å®ç°
â”‚   â”œâ”€â”€ è¡Œ 104-106: çŠ¶æ€å®šä¹‰
â”‚   â”œâ”€â”€ è¡Œ 122-131: loadMore å‡½æ•°
â”‚   â”œâ”€â”€ è¡Œ 185-187: é‡ç½®é€»è¾‘
â”‚   â”œâ”€â”€ è¡Œ 189-251: æ•°æ®è®¡ç®—
â”‚   â””â”€â”€ è¡Œ 768-788: å“¨å…µå…ƒç´ æ¸²æŸ“
â”œâ”€â”€ reducers/
â”‚   â””â”€â”€ notesReducer.js            â† æ”¯æŒæ‰¹é‡æ·»åŠ 
â””â”€â”€ App.css                        â† æ—‹è½¬åŠ¨ç”»
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [Intersection Observer API - MDN](https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API)
- [React Hooks - å®˜æ–¹æ–‡æ¡£](https://react.dev/reference/react)
- [react-window - è™šæ‹Ÿæ»šåŠ¨åº“](https://github.com/bvaughn/react-window)
- [Web æ€§èƒ½ä¼˜åŒ– - Google Developers](https://developers.google.com/web/fundamentals/performance)

---

## ğŸ‰ ç»“è¯­

æ— é™åŠ è½½æ˜¯ä¸€ä¸ªç®€å•ä½†æœ‰æ•ˆçš„æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ï¼Œé€šè¿‡æ¸è¿›å¼åŠ è½½å†…å®¹ï¼Œå¤§å¹…æå‡äº†åº”ç”¨çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚

**æ ¸å¿ƒç†å¿µï¼š** ä¸è¦ä¸€æ¬¡æ€§ç»™ç”¨æˆ·å±•ç¤ºæ‰€æœ‰å†…å®¹ï¼Œè€Œæ˜¯åœ¨éœ€è¦æ—¶æ‰åŠ è½½ã€‚

å¸Œæœ›è¿™ä»½æ–‡æ¡£èƒ½å¸®åŠ©ä½ ç†è§£å’Œåº”ç”¨æ— é™åŠ è½½æŠ€æœ¯ï¼ğŸ’ª

