import { useState, useEffect } from 'react';

/**
 * ========== ğŸ£ è‡ªå®šä¹‰ Hookï¼šuseDebounce ==========
 * 
 * ğŸ“Œ ä½œç”¨ï¼š
 * å»¶è¿Ÿæ›´æ–°å€¼ï¼Œé¿å…é¢‘ç¹è§¦å‘æ“ä½œï¼ˆå¦‚æœç´¢ã€API è¯·æ±‚ï¼‰
 * 
 * ğŸ“Œ å‚æ•°ï¼š
 * @param {any} value - éœ€è¦é˜²æŠ–çš„å€¼
 * @param {number} delay - å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ 500ms
 * 
 * ğŸ“Œ è¿”å›å€¼ï¼š
 * @returns {any} debouncedValue - å»¶è¿Ÿåçš„å€¼
 * 
 * ğŸ“Œ æ ¸å¿ƒæ¦‚å¿µï¼š
 * 1. é˜²æŠ–ï¼ˆDebounceï¼‰ï¼š
 *    - åœ¨äº‹ä»¶è¢«è§¦å‘ n ç§’åå†æ‰§è¡Œå›è°ƒ
 *    - å¦‚æœåœ¨ n ç§’å†…åˆè¢«è§¦å‘ï¼Œåˆ™é‡æ–°è®¡æ—¶
 *    - åº”ç”¨åœºæ™¯ï¼šæœç´¢æ¡†è¾“å…¥ã€çª—å£ resizeã€æŒ‰é’®é˜²é‡å¤ç‚¹å‡»
 * 
 * 2. é—­åŒ…ï¼ˆClosureï¼‰ï¼š
 *    - useEffect çš„æ¸…ç†å‡½æ•°å½¢æˆé—­åŒ…ï¼Œå¯ä»¥è®¿é—® handlerï¼ˆå®šæ—¶å™¨ IDï¼‰
 *    - å³ä½¿ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œæ—§çš„å®šæ—¶å™¨ä¹Ÿèƒ½è¢«æ­£ç¡®æ¸…é™¤
 * 
 * 3. å‰¯ä½œç”¨æ¸…ç†ï¼š
 *    - æ¯æ¬¡ value å˜åŒ–æ—¶ï¼Œæ¸…é™¤ä¸Šä¸€ä¸ªå®šæ—¶å™¨
 *    - é˜²æ­¢å†…å­˜æ³„æ¼å’Œæ„å¤–çš„çŠ¶æ€æ›´æ–°
 */
function useDebounce(value, delay = 500) {
  // ========== 1. åˆ›å»ºé˜²æŠ–åçš„çŠ¶æ€ ==========
  // åˆå§‹å€¼è®¾ä¸ºä¼ å…¥çš„ value
  const [debouncedValue, setDebouncedValue] = useState(value);

  // ========== 2. ä½¿ç”¨ useEffect å®ç°é˜²æŠ–é€»è¾‘ ==========
  useEffect(() => {
    // 2.1 è®¾ç½®å»¶è¿Ÿå®šæ—¶å™¨
    // å½“ value å˜åŒ–æ—¶ï¼Œå»¶è¿Ÿ delay æ¯«ç§’åæ›´æ–° debouncedValue
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    // 2.2 æ¸…ç†å‡½æ•°ï¼šåœ¨ä¸‹æ¬¡ effect æ‰§è¡Œå‰æˆ–ç»„ä»¶å¸è½½æ—¶è°ƒç”¨
    // ğŸ”‘ å…³é”®ï¼šå½¢æˆé—­åŒ…ï¼Œå¯ä»¥è®¿é—®ä¸Šé¢çš„ handler å˜é‡
    // å½“ç”¨æˆ·å¿«é€Ÿè¾“å…¥æ—¶ï¼Œä¼šä¸æ–­æ¸…é™¤æ—§çš„å®šæ—¶å™¨ï¼Œåˆ›å»ºæ–°çš„å®šæ—¶å™¨
    return () => {
      clearTimeout(handler); // æ¸…é™¤ä¸Šä¸€ä¸ªå®šæ—¶å™¨
    };

    // 2.3 ä¾èµ–é¡¹æ•°ç»„ï¼šå½“ value æˆ– delay å˜åŒ–æ—¶é‡æ–°æ‰§è¡Œ effect
  }, [value, delay]);

  // ========== 3. è¿”å›é˜²æŠ–åçš„å€¼ ==========
  return debouncedValue;
}

export default useDebounce;

/**
 * ========== ğŸ“– ä½¿ç”¨ç¤ºä¾‹ ==========
 * 
 * import useDebounce from './hooks/useDebounce';
 * 
 * function SearchComponent() {
 *   const [searchTerm, setSearchTerm] = useState('');
 *   const debouncedSearchTerm = useDebounce(searchTerm, 500);
 * 
 *   // å½“ç”¨æˆ·åœæ­¢è¾“å…¥ 500ms åï¼Œæ‰ä¼šè§¦å‘æœç´¢
 *   useEffect(() => {
 *     if (debouncedSearchTerm) {
 *       // æ‰§è¡Œæœç´¢é€»è¾‘
 *       console.log('æœç´¢:', debouncedSearchTerm);
 *     }
 *   }, [debouncedSearchTerm]);
 * 
 *   return (
 *     <input 
 *       value={searchTerm}
 *       onChange={e => setSearchTerm(e.target.value)}
 *       placeholder="è¾“å…¥æœç´¢å†…å®¹..."
 *     />
 *   );
 * }
 * 
 * ========== ğŸ”‘ é˜²æŠ–åŸç†è¯¦è§£ ==========
 * 
 * ç”¨æˆ·è¾“å…¥ "React"ï¼š
 * 
 * æ—¶é—´è½´ï¼š
 * 0ms:   è¾“å…¥ 'R'  -> å¯åŠ¨ 500ms å®šæ—¶å™¨ A
 * 100ms: è¾“å…¥ 'e'  -> æ¸…é™¤å®šæ—¶å™¨ Aï¼Œå¯åŠ¨ 500ms å®šæ—¶å™¨ B
 * 200ms: è¾“å…¥ 'a'  -> æ¸…é™¤å®šæ—¶å™¨ Bï¼Œå¯åŠ¨ 500ms å®šæ—¶å™¨ C
 * 300ms: è¾“å…¥ 'c'  -> æ¸…é™¤å®šæ—¶å™¨ Cï¼Œå¯åŠ¨ 500ms å®šæ—¶å™¨ D
 * 400ms: è¾“å…¥ 't'  -> æ¸…é™¤å®šæ—¶å™¨ Dï¼Œå¯åŠ¨ 500ms å®šæ—¶å™¨ E
 * 900ms: å®šæ—¶å™¨ E è§¦å‘ -> debouncedValue æ›´æ–°ä¸º "React"
 * 
 * ç»“æœï¼šåªåœ¨ç”¨æˆ·åœæ­¢è¾“å…¥ 500ms åï¼Œæ‰æ‰§è¡Œä¸€æ¬¡æœç´¢
 * 
 * ========== ğŸ†š èŠ‚æµï¼ˆThrottleï¼‰vs é˜²æŠ–ï¼ˆDebounceï¼‰ ==========
 * 
 * é˜²æŠ–ï¼ˆDebounceï¼‰ï¼š
 * - å»¶è¿Ÿæ‰§è¡Œï¼Œé‡æ–°è®¡æ—¶
 * - åœºæ™¯ï¼šæœç´¢æ¡†è¾“å…¥ã€è¡¨å•éªŒè¯
 * - ä¾‹å­ï¼šç”µæ¢¯é—¨ï¼Œæœ‰äººè¿›æ¥å°±é‡æ–°è®¡æ—¶ï¼Œå…³é—¨å»¶è¿Ÿ
 * 
 * èŠ‚æµï¼ˆThrottleï¼‰ï¼š
 * - å›ºå®šé—´éš”æ‰§è¡Œï¼Œä¸é‡æ–°è®¡æ—¶
 * - åœºæ™¯ï¼šæ»šåŠ¨äº‹ä»¶ã€é¼ æ ‡ç§»åŠ¨
 * - ä¾‹å­ï¼šåœ°é“ï¼Œå›ºå®šé—´éš”å‘è½¦ï¼Œä¸ç®¡äººå¤šå°‘
 * 
 * ========== ğŸ” é—­åŒ…è¯¦è§£ ==========
 * 
 * ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ
 * - å‡½æ•° + å‡½æ•°èƒ½è®¿é—®çš„å¤–éƒ¨å˜é‡
 * - å†…å±‚å‡½æ•°å¼•ç”¨å¤–å±‚å‡½æ•°çš„å˜é‡æ—¶ï¼Œå°±å½¢æˆäº†é—­åŒ…
 * 
 * æœ¬ä¾‹ä¸­çš„é—­åŒ…ï¼š
 * ```javascript
 * const handler = setTimeout(...);  // å¤–å±‚å˜é‡
 * return () => {
 *   clearTimeout(handler);  // å†…å±‚å‡½æ•°è®¿é—®å¤–å±‚å˜é‡ -> é—­åŒ…
 * };
 * ```
 * 
 * é—­åŒ…çš„ä½œç”¨ï¼š
 * - å³ä½¿ useEffect æ‰§è¡Œå®Œæ¯•ï¼Œhandler å˜é‡ä»ç„¶è¢«ä¿ç•™
 * - ä¸‹æ¬¡æ¸…ç†æ—¶å¯ä»¥æ­£ç¡®è®¿é—®åˆ°ä¸Šä¸€æ¬¡çš„å®šæ—¶å™¨ ID
 * - ä¿è¯æ¯æ¬¡æ¸…ç†çš„æ˜¯æ­£ç¡®çš„å®šæ—¶å™¨ï¼Œä¸ä¼šæ··ä¹±
 * 
 * é—­åŒ…çš„å®é™…è¿è¡Œæµç¨‹ï¼š
 * 1. ç¬¬ä¸€æ¬¡è¾“å…¥ 'R':
 *    - handler1 = setTimeout(...)
 *    - return æ¸…ç†å‡½æ•°1ï¼ˆé—­åŒ…ä¿å­˜ handler1ï¼‰
 * 
 * 2. ç¬¬äºŒæ¬¡è¾“å…¥ 'e':
 *    - å…ˆæ‰§è¡Œæ¸…ç†å‡½æ•°1ï¼šclearTimeout(handler1) âœ“
 *    - handler2 = setTimeout(...)
 *    - return æ¸…ç†å‡½æ•°2ï¼ˆé—­åŒ…ä¿å­˜ handler2ï¼‰
 * 
 * 3. ç¬¬ä¸‰æ¬¡è¾“å…¥ 'a':
 *    - å…ˆæ‰§è¡Œæ¸…ç†å‡½æ•°2ï¼šclearTimeout(handler2) âœ“
 *    - handler3 = setTimeout(...)
 *    - return æ¸…ç†å‡½æ•°3ï¼ˆé—­åŒ…ä¿å­˜ handler3ï¼‰
 * 
 * æ¯ä¸ªæ¸…ç†å‡½æ•°éƒ½é€šè¿‡é—­åŒ…è®°ä½äº†è‡ªå·±å¯¹åº”çš„å®šæ—¶å™¨ IDï¼
 */

